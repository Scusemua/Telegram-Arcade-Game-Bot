<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>24 Puzzle Game</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        margin: 0;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        color: #333;
      }

      .container {
        max-width: 600px;
        width: 100%;
        background-color: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        padding: 30px;
        text-align: center;
      }

      h1 {
        color: #4a6fa5;
        margin-bottom: 10px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
      }

      .cards {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin: 30px 0;
        flex-wrap: wrap;
      }

      .card {
        width: 80px;
        height: 120px;
        background: linear-gradient(145deg, #ffffff, #e6e9ed);
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 36px;
        font-weight: bold;
        color: #4a6fa5;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
        cursor: pointer;
        user-select: none;
      }

      .card:hover {
        transform: translateY(-5px);
      }

      .card.selected {
        background: linear-gradient(145deg, #ffd86f, #fc6262);
        color: white;
      }

      .operations {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .operation {
        width: 60px;
        height: 60px;
        background-color: #4a6fa5;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 24px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .operation:hover {
        background-color: #3a5a8f;
        transform: scale(1.05);
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
      }

      button {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
      }

      #new-game {
        background-color: #4a6fa5;
        color: white;
      }

      #new-game:hover {
        background-color: #3a5a8f;
      }

      #check {
        background-color: #5cb85c;
        color: white;
      }

      #check:hover {
        background-color: #4cae4c;
      }

      #solution {
        background-color: #f0ad4e;
        color: white;
      }

      #solution:hover {
        background-color: #eea236;
      }

      .expression {
        min-height: 60px;
        margin: 20px 0;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 10px;
        font-size: 24px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 5px;
      }

      .expression-item {
        padding: 5px 10px;
        border-radius: 5px;
      }

      .number {
        background-color: #e3f2fd;
      }

      .operator {
        background-color: #bbdefb;
      }

      .message {
        margin-top: 20px;
        padding: 15px;
        border-radius: 8px;
        font-weight: bold;
        display: none;
      }

      .success {
        background-color: #dff0d8;
        color: #3c763d;
        display: block;
      }

      .error {
        background-color: #f2dede;
        color: #a94442;
        display: block;
      }

      .timer {
        font-size: 18px;
        margin-bottom: 20px;
        color: #666;
      }

      @media (max-width: 600px) {
        .container {
          padding: 20px;
        }

        .card {
          width: 60px;
          height: 90px;
          font-size: 28px;
        }

        .operation {
          width: 50px;
          height: 50px;
          font-size: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>24 Puzzle Game</h1>
      <p class="subtitle">Use all four numbers with +, -, ×, ÷ to make 24</p>

      <div class="timer">Time: <span id="time">00:00</span></div>

      <div class="cards">
        <div class="card" data-number="">?</div>
        <div class="card" data-number="">?</div>
        <div class="card" data-number="">?</div>
        <div class="card" data-number="">?</div>
      </div>

      <button id="new-game">New Game</button>

      <div class="expression" id="expression"></div>

      <div class="operations">
        <button class="operation" data-op="+">+</button>
        <button class="operation" data-op="-">-</button>
        <button class="operation" data-op="×">×</button>
        <button class="operation" data-op="÷">÷</button>
        <button class="operation" data-op="(">(</button>
        <button class="operation" data-op=")">)</button>
        <button class="operation" id="backspace" data-op="backspace">⌫</button>
        <button class="operation" id="clear">C</button>
      </div>

      <div class="controls">
        <button id="check">Check</button>
        <button id="solution">Show Solution</button>
      </div>

      <div class="message" id="message"></div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Game state
        let numbers = [];
        let usedNumbers = [];
        let currentExpression = [];
        let solution = "";
        let startTime = null;
        let timerInterval = null;

        const easy_problems = [[2,2,8,6],[2,2,8,6],[2,2,8,6],[2,2,4,5],[4,2,8,4],[8,1,8,7],[5,4,4,8],[8,8,4,9],[4,4,8,8],[1,1,6,5],[5,4,7,3],[7,6,5,6],[5,1,9,2],[6,4,7,7],[3,9,2,5],[8,3,6,4],[8,3,4,3],[4,8,1,8],[8,8,5,1],[3,7,7,7],[9,7,8,1],[2,4,1,4],[6,6,6,6],[9,2,1,8],[4,3,2,1],[3,6,3,2],[3,4,2,6],[8,2,1,5],[5,1,5,4],[6,2,1,7],[4,8,5,7],[9,6,8,1],[3,9,6,6],[8,2,8,4],[5,7,5,7],[6,8,6,4],[1,8,5,7],[1,6,8,8],[3,4,1,3],[7,1,1,4],[1,2,2,7],[6,1,5,2],[1,2,1,9],[7,3,8,8],[5,4,5,3],[8,1,1,4],[3,3,5,6],[2,2,4,6]];
        const medium_problems = [[2,6,1,6],[5,5,1,9],[2,2,7,6],[3,6,1,6],[2,2,4,7],[4,5,8,6],[3,3,4,5],[5,1,7,4],[7,8,8,9],[2,7,6,8],[3,8,8,9],[6,5,6,8],[2,1,4,9],[6,4,4,2],[6,1,1,9],[3,2,7,4],[5,8,4,9],[4,7,2,6],[6,7,1,9],[7,3,1,3],[8,1,2,7],[2,9,5,5],[6,2,2,5],[5,6,9,1],[4,4,1,8],[9,4,4,1],[2,3,3,8],[5,6,4,9],[3,2,2,6],[2,8,2,9],[6,3,7,5],[5,4,3,9],[5,4,4,3],[3,6,6,2],[4,2,3,4],[1,6,5,3],[5,7,7,6],[4,3,4,7],[3,6,5,2],[8,6,6,2],[2,8,8,7],[5,4,4,6],[3,1,7,2],[1,3,8,5],[8,7,4,8],[7,2,2,8],[5,8,2,6],[1,4,3,7],[7,8,6,5],[4,3,2,5],[6,2,4,9],[4,7,2,4],[2,8,8,9],[3,2,5,8],[8,7,7,2],[3,7,7,2],[4,2,2,8],[8,4,2,9],[4,7,7,1],[7,7,2,5],[4,7,7,5],[5,4,3,6],[3,2,1,6],[6,2,1,9],[7,4,1,9],[6,5,3,8],[8,3,2,4],[7,5,1,9],[5,3,3,9],[5,3,1,7],[6,3,2,9],[6,6,3,8],[6,6,2,9],[6,3,1,8],[3,3,2,7],[4,2,1,7],[7,3,3,8],[6,3,1,7],[6,5,5,8],[5,3,1,9],[6,5,1,8],[7,3,2,8],[6,6,1,5],[4,4,1,7],[4,4,1,6],[5,5,3,7],[4,3,3,7],[5,4,2,7],[5,5,1,6],[6,4,2,6],[8,6,3,9],[8,2,1,8],[7,4,3,9],[7,3,1,8],[3,2,2,7],[7,4,2,8]];
        const hard_problems = [[5,4,2,6],[6,5,2,6],[2,6,8,9],[8,1,3,8],[5,2,9,7],[6,5,2,6],[6,3,2,8],[4,4,2,5],[5,3,3,7],[5,3,2,7],[6,3,3,8],[2,3,2,5],[6,4,1,9],[6,5,1,7],[6,4,1,7],[9,4,4,3],[9,7,2,4],[8,7,4,4],[8,5,2,5],[8,5,3,9],[7,4,3,8],[8,2,1,2],[8,5,2,2],[2,9,2,6],[6,4,2,8],[7,9,2,3],[8,7,5,9],[8,5,2,8],[8,3,2,9],[3,4,1,8],[7,5,5,4],[3,5,2,3],[8,8,5,9],[7,7,3,4],[4,5,1,2],[6,9,5,6],[5,2,2,7],[6,4,1,8],[6,4,1,6],[5,2,2,9],[7,8,3,5],[9,4,4,8],[8,8,7,5],[8,4,4,6],[5,4,2,5],[6,5,2,9],[5,3,3,3],[5,4,1,8],[8,7,2,9],[6,3,2,7]];

        const num_easy = easy_problems.length;
        const num_medium = medium_problems.length;
        const num_hard = hard_problems.length;
        const num_problems = num_easy + num_medium + num_hard;

        // DOM elements
        const cards = document.querySelectorAll(".card");
        const expressionEl = document.getElementById("expression");
        const messageEl = document.getElementById("message");
        const newGameBtn = document.getElementById("new-game");
        const checkBtn = document.getElementById("check");
        const solutionBtn = document.getElementById("solution");
        const clearBtn = document.getElementById("clear");
        const backspaceBtn = document.getElementById("backspace");
        const timeEl = document.getElementById("time");
        const operationBtns = document.querySelectorAll(".operation[data-op]");

        // Initialize game
        newGame();

        // Event listeners
        newGameBtn.addEventListener("click", newGame);
        checkBtn.addEventListener("click", checkSolution);
        solutionBtn.addEventListener("click", showSolution);
        clearBtn.addEventListener("click", clearExpression);
        backspaceBtn.addEventListener("click", backspaceExpression);

        cards.forEach((card) => {
          card.addEventListener("click", () => selectNumber(card));
        });

        operationBtns.forEach((btn) => {
          if (btn.id !== "clear" && btn.id !== "backspace") {
            btn.addEventListener("click", () =>
              addToExpression(btn.dataset.op, "operator")
            );
          }
        });

        function getRandomIntInclusive(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1) + min);
        }

        // Game functions
        function newGame() {
          // Reset game state
          numbers = generateNumbers();
          usedNumbers = [];
          currentExpression = [];
          solution = findSolution(numbers);
          startTimer();

          // Update UI
          updateCards();
          updateExpression();
          messageEl.className = "message";
          messageEl.textContent = "";

          // Log solution for debugging (remove in production)
          console.log("Solution:", solution);
        }

        function getRandomElement(array) {
            const randomIndex = Math.floor(Math.random() * array.length);
            return array[randomIndex];
        }

        function shuffle(array) {
            let currentIndex = array.length;

            // While there remain elements to shuffle...
            while (currentIndex != 0) {

                // Pick a remaining element...
                let randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;

                // And swap it with the current element.
                [array[currentIndex], array[randomIndex]] = [
                array[randomIndex], array[currentIndex]];
            }
        }

        function generateNumbers() {
            const n = getRandomIntInclusive(0, num_problems);
            let difficulty = "";
            let problem = [];

            if (n <= num_easy) {
                difficulty = "easy";
                problem = getRandomElement(easy_problems);
            } else if (n <= num_medium) {
                difficulty = "medium";
                problem = getRandomElement(medium_problems);
            } else {
                difficulty = "hard";
                problem = getRandomElement(hard_problems);
            }

            console.log(`${difficulty}: ${problem}`);
            shuffle(problem);

            return problem;
        }

        function findSolution(nums) {
          // This is a simplified solver that checks common patterns
          // A complete solver would need to check all permutations and operator combinations
          const [a, b, c, d] = nums.sort((x, y) => x - y);

          // Check some common patterns
          if (a + b + c + d === 24) return `${a} + ${b} + ${c} + ${d}`;
          if (a * b * c * d === 24) return `${a} × ${b} × ${c} × ${d}`;
          if (a * b + c * d === 24) return `${a} × ${b} + ${c} × ${d}`;
          if (a * b - c * d === 24) return `${a} × ${b} - ${c} × ${d}`;
          if ((a + b) * (c - d) === 24) return `(${a} + ${b}) × (${c} - ${d})`;
          if (a * b + c * d === 24) return `(${a} × ${b}) + (${c} × ${d})`;
          if (a * b - c * d === 24) return `(${a} × ${b}) - (${c} × ${d})`;
          if ((a + b + c) * d === 24) return `(${a} + ${b} + ${c}) × ${d}`;
          if ((a + b) * c - d === 24) return `(${a} + ${b}) × ${c} - ${d}`;
          if ((a + b) * c + d === 24) return `(${a} + ${b}) × ${c} + ${d}`;

          // If no solution found, return a message
          return "No solution found for these numbers. Try a new game!";
        }

        function startTimer() {
          if (timerInterval) clearInterval(timerInterval);
          startTime = new Date();
          timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
          const now = new Date();
          const elapsed = new Date(now - startTime);
          const minutes = String(elapsed.getMinutes()).padStart(2, "0");
          const seconds = String(elapsed.getSeconds()).padStart(2, "0");
          timeEl.textContent = `${minutes}:${seconds}`;
        }

        function updateCards() {
          cards.forEach((card, index) => {
            card.textContent = numbers[index];
            card.dataset.number = numbers[index];
            card.classList.remove("selected");
          });
        }

        function selectNumber(card) {
          const number = card.dataset.number;
          console.log(`Selected ${number}`);

          // Check if the number is already used
          const usedCount = usedNumbers.filter((n) => n === number).length;
          const totalCount = numbers.filter((n) => n === number).length;
          console.log(`usedCount: ${usedCount}`);
          console.log(`totalCount: ${totalCount}`);

          if (usedCount > 0 && usedCount >= totalCount) {
            showMessage(`You've already used all ${number}s`, "error");
            return;
          }

          // Add to expression
          addToExpression(number, "number");

          // Visual feedback
          card.classList.add("selected");
          setTimeout(() => card.classList.remove("selected"), 300);
        }

        function addToExpression(value, type) {
          currentExpression.push({ value, type });
          updateExpression();
        }

        function isNumeric(str) {
            if (typeof str != "string") return false // Ensures the input is a string
            return !isNaN(str) && // Use type conversion to determine if string is numeric
                    !isNaN(parseFloat(str));
        }

        function backspaceExpression() {
            if (currentExpression.length == 0) {
                return;
            }

            console.log(`currentExpression before: ${JSON.stringify(currentExpression)}`);

            let last = currentExpression.pop();
            if (isNumeric(last)) {
                usedNumbers.remove(last);
            }

            console.log(`currentExpression after: ${JSON.stringify(currentExpression)}`);
            updateExpression();
        }

        function clearExpression() {
          currentExpression = [];
          usedNumbers = [];
          updateExpression();
          messageEl.className = "message";
          messageEl.textContent = "";
        }

        function updateExpression() {
          expressionEl.innerHTML = "";
          usedNumbers = [];

          currentExpression.forEach((item) => {
            const span = document.createElement("span");
            span.textContent = item.value;
            span.className = `expression-item ${item.type}`;
            expressionEl.appendChild(span);

            if (item.type === "number") {
              usedNumbers.push(item.value);
            }
          });
        }

        function checkSolution() {
          try {
            // Convert the expression to a computable string
            let expr = currentExpression.map((item) => item.value).join(" ");

            // Replace × with * and ÷ with / for evaluation
            expr = expr.replace(/×/g, "*").replace(/÷/g, "/");

            // Check if all numbers are used
            const usedAllNumbers = numbers.every((num) => {
              const countInNumbers = numbers.filter((n) => n == num).length;
              const countInUsed = usedNumbers.filter((n) => n == num).length;
              return countInUsed === countInNumbers;
            });

            if (!usedAllNumbers) {
              showMessage(
                "You must use all four numbers exactly once!",
                "error"
              );
              return;
            }

            // Check if the expression is valid
            if (expr.length === 0) {
              showMessage("Please enter an expression", "error");
              return;
            }

            // Check for balanced parentheses
            if (
              (expr.match(/\(/g) || []).length !==
              (expr.match(/\)/g) || []).length
            ) {
              showMessage("Unbalanced parentheses", "error");
              return;
            }

            // Evaluate the expression
            const result = eval(expr);

            // Check if the result is 24
            if (Math.abs(result - 24) < 0.0001) {
              // Allow for floating point precision
              showMessage("Congratulations! You solved it!", "success");
              clearInterval(timerInterval);
            } else {
              showMessage(`That equals ${result}, not 24. Try again!`, "error");
            }
          } catch (e) {
            showMessage(
              "Invalid expression. Please check your input.",
              "error"
            );
          }
        }

        function showSolution() {
          showMessage(`Solution: ${solution}`, "success");
          clearInterval(timerInterval);
        }

        function showMessage(text, type) {
          messageEl.className = "message " + type;
          messageEl.textContent = text;
        }
      });
    </script>
  </body>
</html>
